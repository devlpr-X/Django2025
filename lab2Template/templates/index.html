{% extends "base.html" %}
{% load static %}
{% block content %}
<section class="section-name padding-y-sm">
  <div class="container">

    <header class="section-heading">
      <a href="{% url 'store' %}" class="btn btn-outline-primary float-right">Бүгдийг харах</a>
      <h3 class="section-title">Сүүлд нэмэгдсэн бүтээгдэхүүн ({{ count }} ш)</h3>
    </header>

    <div class="row">
      {% for p in products %}
      <div class="col-md-3">
        <div class="card card-product-grid">
          <a href="{{ p.getUrl }}" class="img-wrap">
            {% if p.images %}
              <img src="{{ p.images.url }}" alt="{{ p.product_name }}" class="img-fluid">
            {% else %}
              <img src="{% static 'images/no_image_available.png' %}" alt="No image" class="img-fluid">
            {% endif %}
          </a>
          <figcaption class="info-wrap">
            <a href="{{ p.getUrl }}" class="title">{{ p.product_name }}</a>
            <div class="price mt-1">{{ p.price }}₮</div>
            <small class="text-muted">Үлдэгдэл: <span id="stock-{{ p.id }}">{{ p.stock }}</span></small>

            <div class="mt-2">
              {% if p.stock > 0 %}
              <button class="btn btn-sm btn-primary btn-block" onclick="increaseStock({{ p.id }})">
                <i class="fas fa-shopping-cart"></i> Сагсанд нэмэх
              </button>
              {% else %}
              <button class="btn btn-sm btn-secondary btn-block" disabled>
                <i class="fas fa-ban"></i> Бараа дууссан
              </button>
              {% endif %}
            </div>
          </figcaption>
        </div>
      </div>
      {% endfor %}
    </div>

  </div>
</section>

<script>
function increaseStock(id) {
  const stockElement = document.getElementById(`stock-${id}`);
  let currentStock = parseInt(stockElement.textContent);
  stockElement.textContent = currentStock + 1;

}
</script>
{% endblock %}
